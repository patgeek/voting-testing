<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Voting.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Voting.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>30/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">85.42% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>41/48</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>12/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>44/44</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// Licence MIT pour le contrat
// SPDX-License-Identifier: MIT
&nbsp;
// Définition de la version du compilateur Solidity à utiliser
pragma solidity ^0.8.28;
&nbsp;
// Import du contrat Ownable d'OpenZeppelin qui gère les permissions
import "@openzeppelin/contracts/access/Ownable.sol";
&nbsp;
// Définition du contrat Voting qui hérite des fonctionnalités de Ownable
contract Voting is Ownable {
    // Variable publique qui stocke l'identifiant de la proposition gagnante
    uint256 public winningProposalID;
&nbsp;
    // Structure qui définit les propriétés d'un votant
    struct Voter {
        // Booléen indiquant si le votant est enregistré dans le système
        bool isRegistered;
        // Booléen indiquant si le votant a déjà voté
        bool hasVoted;
        // Identifiant de la proposition pour laquelle le votant a voté
        uint256 votedProposalId;
    }
&nbsp;
    // Structure qui définit les propriétés d'une proposition
    struct Proposal {
        // Description textuelle de la proposition
        string description;
        // Compteur du nombre de votes reçus par la proposition
        uint256 voteCount;
    }
&nbsp;
    // Énumération qui définit tous les états possibles du processus de vote
    enum WorkflowStatus {
        // État initial : enregistrement des votants
        RegisteringVoters,
        // État : début de l'enregistrement des propositions
        ProposalsRegistrationStarted,
        // État : fin de l'enregistrement des propositions
        ProposalsRegistrationEnded,
        // État : début de la session de vote
        VotingSessionStarted,
        // État : fin de la session de vote
        VotingSessionEnded,
        // État final : votes comptabilisés
        VotesTallied
    }
&nbsp;
    // Variable publique qui stocke l'état actuel du workflow
    WorkflowStatus public workflowStatus;
    // Tableau dynamique qui stocke toutes les propositions
    Proposal[] proposalsArray;
    // Mapping qui associe chaque adresse à un votant
    mapping(address =&gt; Voter) voters;
&nbsp;
    // Événement émis quand un nouveau votant est enregistré
    event VoterRegistered(address voterAddress);
    // Événement émis quand l'état du workflow change
    event WorkflowStatusChange(WorkflowStatus previousStatus, WorkflowStatus newStatus);
    // Événement émis quand une nouvelle proposition est enregistrée
    event ProposalRegistered(uint256 proposalId);
    // Événement émis quand un votant vote
    event Voted(address voter, uint256 proposalId);
&nbsp;
    // Constructeur du contrat qui initialise le propriétaire
    constructor() Ownable(msg.sender) {}
&nbsp;
    // Modificateur qui vérifie si l'appelant est un votant enregistré
    modifier onlyVoters() {
        // Vérifie si l'adresse de l'appelant est enregistrée comme votant
        require(voters[msg.sender].isRegistered, "You are not a voter"); // On aurait aussi pu utiliser une Custom Error
        // Continue l'exécution de la fonction si la condition est remplie
        _;
    }
&nbsp;
    // on peut faire un modifier pour les états
&nbsp;
    // ::::::::::::: GETTERS ::::::::::::: //
&nbsp;
    // Fonction qui retourne les informations d'un votant spécifique
    function getVoter(address _addr) external view onlyVoters returns (Voter memory) {
        // Retourne les informations du votant à l'adresse spécifiée
        return voters[_addr];
    }
&nbsp;
    // Fonction qui retourne les informations d'une proposition spécifique
    function getOneProposal(uint256 _id) external view onlyVoters returns (Proposal memory) {
        // Retourne la proposition à l'index spécifié
        return proposalsArray[_id];
    }
&nbsp;
    // ::::::::::::: REGISTRATION ::::::::::::: //
&nbsp;
    // Fonction pour ajouter un nouveau votant (accessible uniquement par le propriétaire)
    function addVoter(address _addr) external onlyOwner {
        // Vérifie si on est dans la phase d'enregistrement des votants
        require(workflowStatus == WorkflowStatus.RegisteringVoters, "Voters registration is not open yet");
        // Vérifie si le votant n'est pas déjà enregistré
        require(voters[_addr].isRegistered != true, "Already registered");
&nbsp;
        // Enregistre le votant
        voters[_addr].isRegistered = true;
        // Émet l'événement d'enregistrement
        emit VoterRegistered(_addr);
    }
&nbsp;
    // ::::::::::::: PROPOSAL ::::::::::::: //
&nbsp;
    // Fonction pour ajouter une nouvelle proposition
    function addProposal(string calldata _desc) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyVoters {
        // Vérifie si on est dans la phase d'enregistrement des propositions
        require(workflowStatus == WorkflowStatus.ProposalsRegistrationStarted, "Proposals are not allowed yet");
        // Vérifie que la description n'est pas vide
        require(keccak256(abi.encode(_desc)) != keccak256(abi.encode("")), "Vous ne pouvez pas ne rien proposer");
&nbsp;
        // Crée une nouvelle proposition
        Proposal memory proposal;
        // Définit la description de la proposition
        proposal.description = _desc;
        // Ajoute la proposition au tableau
        proposalsArray.push(proposal);
        // Émet l'événement d'enregistrement de la proposition
        emit ProposalRegistered(proposalsArray.length - 1);
    }
&nbsp;
    // ::::::::::::: VOTE ::::::::::::: //
&nbsp;
    // Fonction pour voter pour une proposition
    function setVote(uint256 _id) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyVoters {
        // Vérifie si on est dans la phase de vote
        require(workflowStatus == WorkflowStatus.VotingSessionStarted, "Voting session havent started yet");
        // Vérifie si le votant n'a pas déjà voté
        require(voters[msg.sender].hasVoted != true, "You have already voted");
        // Vérifie si l'ID de la proposition est valide
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_id &lt; proposalsArray.length, "Proposal not found");
&nbsp;
        // Enregistre le vote du votant
        voters[msg.sender].votedProposalId = _id;
        // Marque le votant comme ayant voté
        voters[msg.sender].hasVoted = true;
        // Incrémente le compteur de votes de la proposition
        proposalsArray[_id].voteCount++;
&nbsp;
        // Émet l'événement de vote
        emit Voted(msg.sender, _id);
    }
&nbsp;
    // ::::::::::::: STATE ::::::::::::: //
&nbsp;
    // Fonction pour démarrer l'enregistrement des propositions
    function startProposalsRegistering() external onlyOwner {
        // Vérifie si on est dans la phase d'enregistrement des votants
        require(workflowStatus == WorkflowStatus.RegisteringVoters, "Registering proposals cant be started now");
        // Change l'état vers l'enregistrement des propositions
        workflowStatus = WorkflowStatus.ProposalsRegistrationStarted;
&nbsp;
        // Crée et ajoute la proposition GENESIS
        Proposal memory proposal;
        proposal.description = "GENESIS";
        proposalsArray.push(proposal);
&nbsp;
        // Émet l'événement de changement d'état
        emit WorkflowStatusChange(WorkflowStatus.RegisteringVoters, WorkflowStatus.ProposalsRegistrationStarted);
    }
&nbsp;
    // Fonction pour terminer l'enregistrement des propositions
    function endProposalsRegistering() external <span class="missing-if-branch" title="else path not taken" >E</span>onlyOwner {
        // Vérifie si on est dans la phase d'enregistrement des propositions
        require(
            workflowStatus == WorkflowStatus.ProposalsRegistrationStarted, "Registering proposals havent started yet"
        );
        // Change l'état vers la fin de l'enregistrement des propositions
        workflowStatus = WorkflowStatus.ProposalsRegistrationEnded;
        // Émet l'événement de changement d'état
        emit WorkflowStatusChange(
            WorkflowStatus.ProposalsRegistrationStarted, WorkflowStatus.ProposalsRegistrationEnded
        );
    }
&nbsp;
    // Fonction pour démarrer la session de vote
    function startVotingSession() external <span class="missing-if-branch" title="else path not taken" >E</span>onlyOwner {
        // Vérifie si on est dans la phase de fin d'enregistrement des propositions
        require(
            workflowStatus == WorkflowStatus.ProposalsRegistrationEnded, "Registering proposals phase is not finished"
        );
        // Change l'état vers le début de la session de vote
        workflowStatus = WorkflowStatus.VotingSessionStarted;
        // Émet l'événement de changement d'état
        emit WorkflowStatusChange(WorkflowStatus.ProposalsRegistrationEnded, WorkflowStatus.VotingSessionStarted);
    }
&nbsp;
    // Fonction pour terminer la session de vote
    function endVotingSession() external <span class="missing-if-branch" title="else path not taken" >E</span>onlyOwner {
        // Vérifie si on est dans la phase de vote
        require(workflowStatus == WorkflowStatus.VotingSessionStarted, "Voting session havent started yet");
        // Change l'état vers la fin de la session de vote
        workflowStatus = WorkflowStatus.VotingSessionEnded;
        // Émet l'événement de changement d'état
        emit WorkflowStatusChange(WorkflowStatus.VotingSessionStarted, WorkflowStatus.VotingSessionEnded);
    }
&nbsp;
    // Fonction pour comptabiliser les votes et déterminer le gagnant
    function tallyVotes() external <span class="missing-if-branch" title="else path not taken" >E</span>onlyOwner {
        // Vérifie si on est dans la phase de fin de session de vote
        require(workflowStatus == WorkflowStatus.VotingSessionEnded, "Current status is not voting session ended");
        // Variable temporaire pour stocker l'ID de la proposition gagnante
        uint256 _winningProposalId;
        // Parcourt toutes les propositions pour trouver celle avec le plus de votes
        for (uint256 p = 0; p &lt; proposalsArray.length; p++) {
            // Compare le nombre de votes de la proposition courante avec la meilleure proposition actuelle
            if (proposalsArray[p].voteCount &gt; proposalsArray[_winningProposalId].voteCount) {
                // Met à jour l'ID de la proposition gagnante si nécessaire
                _winningProposalId = p;
            }
        }
        // Stocke l'ID de la proposition gagnante
        winningProposalID = _winningProposalId;
&nbsp;
        // Change l'état vers la fin du processus (votes comptabilisés)
        workflowStatus = WorkflowStatus.VotesTallied;
        // Émet l'événement de changement d'état
        emit WorkflowStatusChange(WorkflowStatus.VotingSessionEnded, WorkflowStatus.VotesTallied);
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat May 31 2025 11:53:28 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
